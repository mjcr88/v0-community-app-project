# Plan: Remediation for PR #106 Review

**Date**: 2026-02-12
**Source**: [PR #106 Review](https://github.com/mjcr88/v0-community-app-project/pull/106)

## Summary
Address critical feedback from CodeRabbit regarding security (tenant isolation), race conditions, migration safety, and documentation consistency.

## Assignments

### 1. Backend Specialist (`backend-specialist`)

**Objective**: Secure data access and ensure migration stability.

*   **[Security] Tenant Isolation in `checkLocationAvailability`**
    *   **File**: `app/actions/events.ts`
    *   **Task**: Validate that the authenticated `user` belongs to the requested `tenantId` *before* initializing the Service Role client.
    *   **Why**: Prevent IDOR where a user could query conflict counts for other tenants.

*   **[Validation] Stricter Input Schema**
    *   **File**: `app/actions/events.ts`
    *   **Task**: Update `CheckAvailabilityInput` Zod schema.
        *   Regex for `startDate`, `endDate` (`YYYY-MM-DD`).
        *   Regex for `startTime`, `endTime` (`HH:MM`).
        *   Refine: Require *both* start/end times or *neither*.

*   **[Infra] Fix Migration Transaction Safety**
    *   **File**: `supabase/migrations/20260212000001_add_events_location_date_index.sql`
    *   **Task**: Remove `CONCURRENTLY` keyword.
    *   **Why**: Supabase migration runner wraps execution in a transaction, which blocks concurrent index creation.

### 2. Frontend Specialist (`frontend-specialist`)

**Objective**: Improve UI robustness and documentation accuracy.

*   **[UX/Bug] Fix Race Condition in Availability Check**
    *   **File**: `app/t/[slug]/dashboard/events/(management)/create/event-form.tsx`
    *   **Task**: Implement a mechanism (e.g., `activeRequest` ref) to ignore stale responses in the debounced `checkAvailability` effect.

*   **[UX] Add Loading State to Edit Form**
    *   **File**: `app/t/[slug]/dashboard/events/(management)/[eventId]/edit/edit-event-form.tsx`
    *   **Task**: Introduce `isCheckingAvailability` state. Disable default submit button while checking.

*   **[Docs] Standardize Route Paths**
    *   **File**: `docs/07-product/02_requirements/requirements_2026-02-10_view_on_map_refactor.md`
    *   **Task**:
        *   Change paths to include `p/[slug]` prefix (e.g., `/t/${slug}/dashboard/community-map`).
        *   Align URL parameter name (`highlightLocationId`) with component prop.

## Handover Plan
1.  **Backend Specialist** executes fixes first to ensure API contract is solid.
2.  **Frontend Specialist** follows up with UI hardening and Doc updates.
3.  **QA** (User/Auto) verifies the changes.
